================================================================================
日本株スイングトレード推奨システム - 使用ガイド
================================================================================

作成日: 2026-01-19
バージョン: 1.0

================================================================================
目次
================================================================================
1. 環境構築
2. バックテストの実行方法
3. 本番の実行方法
4. パラメータ調整
5. 注意事項

================================================================================
1. 環境構築
================================================================================

【必要条件】
- Python 3.9以上
- pip（Pythonパッケージマネージャー）

【インストール手順 - Anaconda】

# 1. 仮想環境を作成
conda create -n finance python=3.11 -y

# 2. 仮想環境を有効化
conda activate finance

# 3. リポジトリをクローン
git clone <repository-url>
cd finance

# 4. 依存関係をインストール
pip install -e .

# 5. 追加ライブラリ（実データ取得用）
pip install yfinance

# 6. 機械学習機能を使う場合（オプション）
conda install lightgbm xgboost -c conda-forge -y

# 仮想環境の終了
conda deactivate

# 仮想環境の削除（不要になった場合）
conda remove -n finance --all


【インストール手順 - pip（Anaconda以外）】

# リポジトリをクローン
git clone <repository-url>
cd finance

# 仮想環境を作成（推奨）
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 依存関係をインストール
pip install -e .

# 追加ライブラリ（実データ取得用）
pip install yfinance

# 機械学習機能を使う場合（オプション）
pip install lightgbm xgboost

================================================================================
2. バックテストの実行方法
================================================================================

【方法A】シミュレーションデータでのバックテスト（ネットワーク不要）
----------------------------------------------------------------------------

# シミュレーションデータで基本テスト
python scripts/validate_enhanced_backtest.py

出力例:
- Total Return: +3.51%
- Win Rate: 48.4%
- Profit Factor: 1.02

※ シミュレーションデータは実際の市場を完全に再現していないため、
  参考値としてのみ使用してください。


【方法B】実データでのバックテスト（推奨）
----------------------------------------------------------------------------

# ステップ1: 実データを取得（インターネット接続が必要）
python scripts/fetch_real_data.py

# 取得される銘柄（20銘柄）:
# - トヨタ(7203.T), ホンダ(7267.T), ソニー(6758.T), キーエンス(6861.T)
# - MUFG(8306.T), SMFG(8316.T), NTT(9432.T), ソフトバンクG(9984.T)
# - 任天堂(7974.T), ファーストリテイリング(9983.T) など

# ステップ2: 実データでバックテスト
python scripts/validate_with_real_data.py

# データは data/historical/ に保存されます


【方法C】パラメータチューニング
----------------------------------------------------------------------------

# 最適なパラメータを探索
python scripts/validate_backtest_tuned.py

# テストされるパラメータ:
# - min_score: 50, 55, 60, 65, 70
# - min_confidence: 0.50, 0.55, 0.60, 0.65, 0.70


【バックテスト結果の見方】
----------------------------------------------------------------------------

主要指標:
- Total Return    : 総リターン率（目標: +30%以上/3年）
- CAGR           : 年平均成長率（目標: +10%以上）
- Win Rate       : 勝率（目標: 55%以上）
- Profit Factor  : 利益/損失の比率（目標: 1.5以上）
- Sharpe Ratio   : リスク調整後リターン（目標: 1.0以上）
- Max Drawdown   : 最大下落率（目標: 20%以下）


================================================================================
3. 本番の実行方法
================================================================================

【重要】本番運用前の確認事項
----------------------------------------------------------------------------

□ 実データでのバックテストで以下を達成していること:
  - Win Rate > 50%
  - Profit Factor > 1.2
  - Max Drawdown < 25%

□ ペーパートレーディングを最低1ヶ月実施していること

□ 失っても問題ない資金のみを使用すること


【ステップ1】推奨銘柄の取得
----------------------------------------------------------------------------

# 推奨銘柄スクリーニング（毎日実行）
python -c "
from src.analysis.indicators import TechnicalIndicators
from backtesting.scoring_engine import ScoringEngine
import yfinance as yf

# 対象銘柄リスト
symbols = ['7203.T', '6758.T', '9984.T', '8306.T', '9432.T']

indicator_engine = TechnicalIndicators()
scoring_engine = ScoringEngine()

print('=' * 60)
print('本日の推奨銘柄スクリーニング')
print('=' * 60)

for symbol in symbols:
    try:
        ticker = yf.Ticker(symbol)
        df = ticker.history(period='6mo')

        if df.empty:
            continue

        df_with_ind = indicator_engine.calculate_all(df)
        indicators = df_with_ind.iloc[-1].to_dict()

        result = scoring_engine.calculate_score(indicators)
        score = result['total_score']
        confidence = result['confidence']

        if score >= 55 and confidence >= 0.60:
            print(f'[推奨] {symbol}: スコア={score:.1f}, 信頼度={confidence:.1%}')
        else:
            print(f'[様子見] {symbol}: スコア={score:.1f}, 信頼度={confidence:.1%}')

    except Exception as e:
        print(f'[エラー] {symbol}: {e}')

print('=' * 60)
"


【ステップ2】エントリー判断
----------------------------------------------------------------------------

推奨銘柄が表示されたら:

1. スコア65以上、信頼度70%以上の銘柄を選択
2. 以下を手動で確認:
   - 決算発表が3日以内にないこと
   - 大きなニュースがないこと
   - 市場全体のトレンドが下落でないこと

3. ポジションサイズ計算:
   - 1銘柄あたり資金の20%以下
   - ATRの2倍をストップロスに設定
   - 最大5銘柄まで同時保有


【ステップ3】ポジション管理
----------------------------------------------------------------------------

毎日のチェック項目:

□ 含み益が3%を超えたらトレーリングストップを設定
  → 最高値から2%下落で決済

□ ストップロス（エントリー価格 - ATR×2）に達したら損切り

□ 保有15日を超えたら決済検討

□ スコアが50未満に低下したら決済検討


【ステップ4】記録と分析
----------------------------------------------------------------------------

取引記録を残す項目:
- 銘柄コード
- エントリー日時、価格
- エントリー時のスコア
- 決済日時、価格
- 決済理由（利確/損切り/期間/スコア低下）
- 損益

月次で分析:
- 勝率
- 平均利益/平均損失
- プロフィットファクター
- 最大ドローダウン


================================================================================
4. パラメータ調整
================================================================================

【設定ファイル】
config/settings.py

【主要パラメータ】

SCREENING_CRITERIA:
  min_score: 65        # 最低スコア（下げると取引増、勝率低下）
  min_confidence: 0.70 # 最低信頼度（下げると取引増、勝率低下）

RISK_PARAMS:
  position_size_pct: 0.20      # 1銘柄あたりの資金配分
  stop_loss_atr_multiplier: 2.0 # ストップロスの幅（ATR倍率）
  max_holding_days: 15          # 最大保有日数

MARKET_REGIME_PARAMS:
  bull_min_score: 55   # 強気相場での最低スコア
  bear_min_score: 75   # 弱気相場での最低スコア（厳しく）


【パラメータ調整のガイドライン】

勝率を上げたい場合:
  → min_score を 70 に上げる
  → min_confidence を 0.75 に上げる
  → bear_min_score を 80 に上げる

取引回数を増やしたい場合:
  → min_score を 55 に下げる
  → min_confidence を 0.55 に下げる
  ※ 勝率は低下する可能性あり

リスクを下げたい場合:
  → position_size_pct を 0.15 に下げる
  → max_positions を 3 に下げる
  → stop_loss_atr_multiplier を 1.5 に下げる


================================================================================
5. スマホで確認（Webダッシュボード）
================================================================================

【セットアップ】

# Flaskをインストール
pip install flask

# または
pip install -e ".[dashboard]"


【起動方法】

# ステップ1: 日次レポートを生成
python scripts/generate_daily_report.py

# ステップ2: ダッシュボードサーバーを起動
python -m dashboard.app

# サーバーが起動したら以下のURLにアクセス:
# PC:     http://localhost:5000
# スマホ: http://<PCのIPアドレス>:5000


【PCのIPアドレスを確認】

Windows:
  ipconfig

Mac/Linux:
  ifconfig
  # または
  ip addr


【自動更新設定（Cron）】

毎日朝8時にレポートを更新:

# crontab -e で以下を追加
0 8 * * * cd /path/to/finance && python scripts/generate_daily_report.py


【ダッシュボード機能】

- Market Regime: 現在の市場状況（Bull/Bear/Sideways）
- Today's Picks: 本日の推奨銘柄（スコア順）
- Open Positions: 保有中のポジション
- Performance: 運用成績サマリー

※ 5分ごとに自動リフレッシュ


================================================================================
6. 注意事項
================================================================================

【リスク警告】

- 株式投資には元本割れのリスクがあります
- 過去のバックテスト結果は将来の収益を保証しません
- 信用取引はレバレッジにより損失が拡大する可能性があります
- 必ず余裕資金で運用してください

【システムの限界】

- テクニカル分析のみに基づいており、ファンダメンタルズは考慮していません
- 決算発表、ニュース、地政学リスクなどは反映されません
- 市場の急変時には想定外の損失が発生する可能性があります
- 流動性の低い銘柄では、シミュレーション通りの約定ができない場合があります

【推奨事項】

1. 最初は少額（資金の10%以下）で開始
2. 最低3ヶ月はペーパートレーディングで検証
3. 取引記録を必ず残し、定期的に分析
4. 感情的な取引を避け、システムのルールに従う
5. 損失が続く場合は運用を停止し、戦略を見直す


================================================================================
お問い合わせ
================================================================================

バグ報告・機能要望:
https://github.com/anthropics/claude-code/issues


================================================================================
